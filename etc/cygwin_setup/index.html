<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">    
    <link rel='stylesheet' href='https://cdn.jsdelivr.net/gh/kognise/water.css@latest/dist/light.css'>
    <link rel='stylesheet' href='../../style.css'> 
    <link rel='icon' href='../../favicon.ico'>

    <title>Shunsuke A. Sato</title>
  </head>
  <body>

    <header>
      <h1>Shunsuke A. Sato </h1>
    </header>
	  <main>
      <ul id="nav">
        <li><a href="../../index_ja.html">ホーム</a></li>
        <li><a href="../../cv_ja.html">連絡先/経歴</a></li>
        <li><a href="../../publication_ja.html">論文</a></li>
        <li><a href="../../presentation_ja.html">発表</a></li>
        <li class='current'><a href="../../etc_ja.html">その他</a></li>
        <li><a href="../../index.html">English</a></li>
      </ul>

      <h2 style="color:#FF3C3C;">Windows PC上でのCygwin環境の構築 </h2>(最終更新日:2022/05/10)
      <p>授業でFortran等を用いた数値計算の実習する際に、Windows PC上にCygwin環境を構築する方法を解説します。本ページの解説は、「<a href="https://www.sw.it.aoyama.ac.jp/2011/CP1/cygwin/">Cygwin インストール</a>」を参考に書かれています。リンク先のページも参考にしてください。</p>
      <p>以下では、「<a href="#cygwin">1. Cygwinのインストール</a>」、「<a href="#fortran">2. Fortranプログラムの実行</a>」、「<a href="#gnuplot">3. gnuplotによる数値計算結果描画環境の構築</a>」について、それぞれ説明します。</p>
      <hr>
      

      <section>

        <h2><a style="color:blue;" name="cygwin">1. Cygwinのインストール</a></h2>
	<p><b>Step 1:</b><br> まず、Windows PCにCygwinをインストールしていきます。<a href="https://www.cygwin.com/">Cygwinのwebサイト</a>からCygwinのインストーラーをダウンロードします。インストーラーは下の画像のように、"Installing Cygwin"の箇所の赤線で囲まれた部分からダウンロードすることが出来ます。
	</p>
	<img src="./fig/cygwin_installer.png" alt="Cygwin download page" />

	
	<br><br><hr>
	<p><b>Step 2:</b><br>
	  ダウンロードしたCygwinのインストーラを起動すると下記のようなアプリケーションが立ち上がるので、「次へ」をクリックしてインストールを進めていきます。
	</p>
	<img src="./fig/cygwin_install_01.png" alt="Cygwin installing 01" />

	<br><br><hr>
	<p><b>Step 3:</b><br>
	  どこのCygwinソースを使うかを聞かれるので、デフォルト選択肢の"Install from Internet"を選択して「次へ」をクリックし、インストールをさらに進めます。
	</p>
	<img src="./fig/cygwin_install_02.png" alt="Cygwin installing 02" />

	<br><br><hr>
	<p><b>Step 4:</b><br>
	  次に、どのディレクトリ/フォルダにCygwinをインストールするかを聞かれるので、特にこだわりがなければ、デフォルト選択肢のまま「次へ」をクリックし、インストールをさらに進めます。
	</p>
	<img src="./fig/cygwin_install_03.png" alt="Cygwin installing 03" />		
	

	<br><br><hr>
	<p><b>Step 5:</b><br>
	  次に、どのディレクトリ/フォルダにCygwinでつかうパッケージをダウンロードするかを聞かれるので、特にこだわりがなければ、デフォルト選択肢のまま「次へ」をクリックし、インストールをさらに進めます。
	</p>
	<img src="./fig/cygwin_install_04.png" alt="Cygwin installing 04" />


	<br><br><hr>
	<p><b>Step 6:</b><br>
	  次に、インターネットへどのように接続するかを聴かれますが、デフォルト選択肢のまま「次へ」をクリックし、インストールをさらに進めます。
	</p>
	<img src="./fig/cygwin_install_05.png" alt="Cygwin installing 05" />

	<br><br><hr>
	<p><b>Step 7:</b><br>
	  次に、どのサイトからダウンロードするかを聞かれます。国内でインストールする場合は、国内のサイト(.jpで終わるもの)からダウンロードするとダウンロードが早く終わると予想されます。下記画像では"http://ftp.jaist.ac.jp"からダウンロードしています。
	</p>
	<img src="./fig/cygwin_install_06.png" alt="Cygwin installing 06" />		


	<br><br><hr>
	<p><b>Step 8:</b><br>
	  次に、どのパッケージ(コンパイラやその他のソフト等)をインストールするかを選んでいきます。まず、下の図の赤線で囲われた箇所の"View"の欄の"Category"をクリックし、"Full"に変更します。
	</p>
	<img src="./fig/cygwin_install_07.png" alt="Cygwin installing 07" />

	<br><br><hr>
	<p><b>Step 9:</b><br>
	  次に、どのパッケージ(コンパイラやその他のソフト等)をインストールするかを選んでいきます。まず、下の図の赤線で囲われた箇所の"View"の欄の"Category"をクリックし、"Full"に変更します。
	</p>
	<img src="./fig/cygwin_install_07.png" alt="Cygwin installing 07" />			

	<br><br><hr>	
	<p><b>Step 10:</b><br>
	  次に、どのパッケージを選んでいきます。ここでは、<b>diffutils, gcc-core, gcc-g++, gcc-fortran, gnuplot-base,gnuplot-X11, emacs-w32</b>の7つのパッケージをデフォルトのパッケージに追加してインストールしていきます。まず、下図の赤線の部分のsearchにそれぞれのパッケージの名前を入れ、パッケージを検索します。次に、検索により見つかったパッケージのNewの欄(下図の青線で囲まれた部分)をクリックして、パッケージのバージョンを選びます。特にこだわりが無ければ、安定版(非test版)で最新のものを選びましょう。尚、"Skip"はインストールを行わないことを意味しており、初めから"Skip"以外のバージョンが指定されている場合は、そのままにしておきましょう。上記の全てのパッケージについてパッケージの選択が終わったら、右下にある「次へ」をクリックしてファイルのダウンロードを進めます。<a style="color:#FF3C3C;">また、ここで追加し忘れてしまったパッケージや新しく使いたいパッケージがあとから出てきた場合は、ここで用いているインストーラを使って、ここまでと同様の手順を踏むことで、既にインストールされているCygwinにパッケージを追加することが出来ます。</a>
	</p>
	<img src="./fig/cygwin_install_08.png" alt="Cygwin installing 08" />

	<br><br><hr>	
	<p><b>Step 11:</b><br>
	  下図のように、どのパッケージをインストールするか確認をされるので、問題なければ「次へ」をクリックしてインストールを続けます。
	</p>
	<img src="./fig/cygwin_install_09.png" alt="Cygwin installing 09" />

	<br><br><hr>	
	<p><b>Step 12:</b><br>
	  インターネットを経由してファイルのダウンロードとインストールが始まります。ダウンロード・インストールにはしばらく時間がかかることがあり、15分から30分程度かかる事もあるようです。この解説ページを作っている際の環境では、この工程に<a style="color:#FF3C3C;">5分程度の時間がかかりました</a>。
	</p>
	<img src="./fig/cygwin_install_10.png" alt="Cygwin installing 10" />

	<br><br><hr>	
	<p><b>Step 13:</b><br>
	  インストールが終わると、下記のような報告が出ますので、そのまま「完了」をクリックし、インストールを完了してください。
	</p>
	<img src="./fig/cygwin_install_11.png" alt="Cygwin installing 11" />

	<br><br><hr>	
	<p><b>Step 14:</b><br>
	  最後に、Cygwinに正しくFortranがインストールされたかを確認して、環境構築を終了します。先ほどの工程でデスクトップ画面に作られたCygwinのショートカットからCygwinを起動します。起動したCygwin上で、下記の画像のように"gfortran"または"gfortran.exe"を入力し、Enterキーを押します。すると
	  <pre><code>gfortran: fatal error: no input files
compilation terminated.</code></pre>
	  というようなエラーメッセージが出力されます。このようなメッセージが出力されれば、正常にFortranコンパイラがインストールされていますので、環境構築作業は終わりです。
	</p>
	<img src="./fig/fortran_chk.png" alt="Check Fortran installation" />

	<br><br><hr>

        <h2><a style="color:blue;" name="fortran">2. Fortranプログラムの実行</a></h2>
	<p><b>Step 1:</b><br> ここでは上記で準備されたCygwin上で、簡単なFortranのプログラムを書いて実行してみます。まず、Cygwinを立ち上げ、下の画像のようにコマンド<code>pwd</code>を入力しEnterキーを押してみます。すると、今、ターミナルが開かれているディレクトリ/フォルダの場所・名前が表示されます。下の画像では、ターミナルが<code>/home/shuns</code>というディレクトリで開かれていることが示されています。
	  <img src="./fig/fortran_01.png" alt="Fortran 01" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 2:</b><br> 次に、ターミナル上でコマンド<code>ls</code>を打ってみます。このコマンドは、現在ターミナルが開かれているディレクトリの中にあるファイル・ディレクトリの名前のリストを出力するコマンドです。Cygwinをインストールした直後の場合、ユーザーのディレクトリが空になっているので、下の画像のように何も出力が表示されないかもしれません。
	  <img src="./fig/fortran_02.png" alt="Fortran 02" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 3:</b><br> 次に、エディター(ファイル編集ソフト)を使って、Fortranの簡単なプログラムを書いてみます。ここでは、上記のcygwinのインストールの際に一緒にインストールしたemacsというエディタを使ってみます。下の画像のように、ターミナル上で<code>emacs hello.f90</code>と入力しEnterキーを押すと、emacsエディタでhello.f90という名前のファイルを開き編集を行うことが出来るようになります。ここでは、さらに次のようなコードをファイルに書き込み、プログラムを保存してemacsを閉じます。
	  <pre><code>program main
  write(*,*)'Hello world!!'
end program</code></pre>
	  <img src="./fig/fortran_03.png" alt="Fortran 03" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 4:</b><br> 上記の作業でemacsエディタによりhello.f90というFortranのプログラムを作成したので、再びターミナル上で<code>ls</code>コマンドを実行し、hello.f90ファイルが作られているかを確認します。下の画像では、<code>ls</code>コマンドによって、ファイル<code>hello.f90</code>が新しく作られていることを確認しています。
	  <img src="./fig/fortran_04.png" alt="Fortran 04" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 5:</b><br> 次に、Fortranのコード<code>hello.f90</code>からコンピュータが実行可能な実行ファイルを作る作業を行います。この作業はコンパイルと呼ばれ、次のようなコマンドをターミナル上で打ち込むことにより実行できます。<pre><code>gfortran hello.f90 -o hello</code></pre>
	  このコマンドにより、Fortranのソースファイルhello.f90がコンパイルされ、実行ファイル<code>hello.exe</code>が作成されます。実行ファイルが作成されたか、再び<code>ls</code>コマンドを使って確認してみましょう。
	  <img src="./fig/fortran_05.png" alt="Fortran 05" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 6:</b><br> 最後に、作成された実行ファイル<code>hello.exe</code>を実際に実行してみます。ファイルを実行するために、下記のコマンドをターミナル上で打ち込んでみます。<pre><code>./hello.exe</code></pre>
	  すると、画面上に"Hello world!!"という文字列が出力されます。これは、先ほど作成したプログラムによって出力された文字列です。さらにFortran言語を使ったプログラミングについて学びたい方は、<a href="https://wwwnucl.ph.tsukuba.ac.jp/comp_phys">筑波大学原子核理論研究室の数値計算</a>のページをご覧ください。
	  <img src="./fig/fortran_06.png" alt="Fortran 06" />	  
	</p>	
	<br><br><hr>					

        <h2><a style="color:blue;" name="gnuplot">3. gnuplotによる数値計算結果可視化環境の構築</a></h2>
	<p><b>Step 1:</b><br> ここでは上記で準備されたCygwin上で、gnuplot(<a href="http://www.gnuplot.info/">http://www.gnuplot.info/</a>)を用いて数値計算結果をグラフにして可視化するための環境を構築します。上記のCygwinインストール時にgnuplotも同時にインストールされているので、Cygwin上で"gnuplot"と入力しEnterキーを押すことで、下図のようにgnuplotを起動することが出来ます。
	  <img src="./fig/gnuplot_prep_01.png" alt="Gnuplot preparation 01" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 2:</b><br> 次に、起動したgnuplotで三角関数のグラフを描画することを試みます。起動したgnuplotのコマンドライン(下記画像の"gnuplot >"の箇所)に次のようなコマンドを入力し、Enterキーを押します。
	  <pre><code>gnuplot> plot sin(x) with line</code></pre>
	  これは、三角関数(sin(x))の線を描画する命令ですが、下図のようなエラーメッセージが出力され、グラフの描画に失敗してしまいます。
	  <pre><code>gnuplot: unable to open display 'localhost:0.0'
gnuplot: X11 aborted.</code></pre>
	  これは、Cygwin側での描画命令を受けてパソコン上で画像を表示するソフトが動いていないことによるエラーです。この問題を解決するために、Xming (<a href="http://www.straightrunning.com/XmingNotes/">http://www.straightrunning.com/XmingNotes/</a>)をインストールします。<a fref="https://sourceforge.net/projects/xming/">Xmingのダウンロードサイト</a>から下図赤線のようなダウンロードボタンからXmingのインストーラーをダウンロードします。
	  <img src="./fig/xming_install_01.png" alt="Xming install 01" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 3:</b><br> 上記のステップでダウンロードしたインストーラを起動し、Xmingのインストールを進めていきます。基本的にデフォルトの選択肢を選んでいけば問題ありませんが、下図のように「インストールした後にデスクトップにXmingのショートカットを作るか」を聞かれますので、"<b>Create a desktop icon for Xming</b>"の箇所にチェックを入れてショートカットを作っておくと、後々便利です。
	  <img src="./fig/xming_install_02.png" alt="Xming install 02" />	  
	</p>	
	<br><br><hr>

	<p><b>Step 4:</b><br> Xmingのインストールが終了すると、自動的にXmingが起動します。Xmingが起動している場合、下図の右下のようにXmingのアイコンが表示されます。XmingはPCの起動と同時には立ち上がらないので、Cygwinでgnuplotを使う際には自分でXmingを起動する必要があります。その場合は、このインストールの過程で作成されたデスクトップ上のXmingのショートカットから起動するか、WindowsのスタートアップにXmingを登録して自動でPC立ち上げ時に自動で起動するようにしておきましょう。
	  <img src="./fig/xming_install_03.png" alt="Xming install 03" />	  
	</p>	
	<br><br><hr>


	<p><b>Step 5:</b><br> 最後に、Cygwinを起動し、ホームディレクトリ(立ち上げたにいるディレクトリ)にある.bashrcファイルに下記の行を追記して、再度Cygwinを再起動します。
	  <pre><code>export DISPLAY=localhost:0.0</code></pre>
	  これにより、Xmingを通じてディスプレイ上にグラフが描画されるようになります。尚、Cygwinを再起動する代わりに、Cygwin上で<pre><code>source .bashrc</code></pre>を実行することで、更新した".bashrc"ファイルを再読み込みすることで設定を更新することもできます。
	</p>	
	<br><br><hr>

	<p><b>Step 6:</b><br> gnuplotでの描画環境が正しく設定されたか確認するために、上記のstep 1とstep 2を再度行ってみましょう。正しく環境が設定されて入れば、下図のようにgnuplotによって三角関数が画面上に描画されます。正しく画像が描画されれば、gnuplotを使った数値計算可視化環境の構築は終了です。
	  <img src="./fig/gnuplot_chk_01.png" alt="Gnuplot check 01" />	  
	</p>	
	<br><br><hr>
	

	
      </section>
    </main>
    <footer>
<br><br><br>
    </footer>
  </body>
</html>
